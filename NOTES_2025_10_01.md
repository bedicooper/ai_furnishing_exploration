# Session Notes - October 1, 2025

## ğŸ¯ Today's Achievements

### 1. Project Setup âœ…
- Created complete project structure
- Set up `ai_furnishing_exploration/` workspace
- Set up `datasets_pipelines/apartment_jsons_pipe/` data pipeline structure

### 2. Documentation âœ…
- Completed `PRD.md` with full project plan
- Created `README.md` with project overview
- Created `TODO.md` with actionable checklist
- Documented approach: **Hybrid 2-Stage Pipeline**

### 3. Utility Scripts âœ…
- `utils/json_processing.py` - Functions for apartment JSON manipulation
- `utils/svg_parser.py` - SVG furniture catalog extraction
- `utils/furniture_catalog.py` - Furniture dimensions and semantic rules

### 4. Notebooks âœ…
- `notebooks/eda_apartments.ipynb` - Data exploration
- `notebooks/extract_furniture_catalog.ipynb` - SVG â†’ JSON conversion
- `notebooks/visualize_apartments.ipynb` - Visualization helpers

---

## ğŸ”‘ Key Decisions

### Decision: Hybrid 2-Stage Pipeline

**Rationale**: After analyzing LLM capabilities vs problem requirements:

#### Stage 1: Semantic Model (What to place)
- **Task**: `room_type` + `features` â†’ `[furniture_ids]`
- **Approach**: Fine-tune LLM (LLaMA-3-8B)
- **Why**: LLM excellent at pattern matching
  - Learns `idBedroom` â†’ `["b2", "sz", "wardrobe"]` from 100k examples
  - No need to understand "b2 = bed" semantically
  - Can generate diverse combinations (temperature sampling)

#### Stage 2: Geometric Solver (Where to place)
- **Task**: `furniture_ids` + `boundary` + `dimensions` â†’ `[insert_points, angles]`
- **Approach**: Rule-based (initially) or VAE/Diffusion
- **Why**: LLM struggles with geometry
  - Insert points are continuous coordinates
  - Need to understand spatial constraints (walls, doors, collisions)
  - Rules are interpretable and debuggable

### Why NOT End-to-End LLM?
User's concern: *"LLM nie poradzi sobie z geometriÄ… bez rozumienia rozmiaru"*

**Analysis**: CORRECT! 
- LLM sees `"insert_point": [1086.01, 190.01]` as arbitrary numbers
- Without furniture dimensions, can't learn spatial feasibility
- Black-box end-to-end â†’ hard to fix "bed sticking through wall"

**Solution**: Separate concerns
- LLM: semantic reasoning (what belongs where)
- Geometric solver: spatial reasoning (valid placement)

---

## ğŸ“Š Data Insights

### Apartment JSONs Structure
```json
{
  "apartments": [{
    "compartments": [{
      "name_cad": "idBedroom",
      "area": 10.94,
      "boundary": {"contour": [[x,y], ...], "islands": [...]},
      "equipments": [{
        "id": "b2",
        "insert_point": [1086.01, 190.01],
        "angle": 90,
        "x_scale": 2.05,
        "y_scale": 1.5
      }]
    }]
  }]
}
```

### Key Properties:
- **~100k apartments** with furniture (ground truth)
- Each apartment has **ONE furnished version** (not multiple variants)
- **Repeating patterns**: Many similar room shapes (good for learning!)
- **No absurdities**: Historical projects, manually designed
- **Insert point**: Top-left corner of furniture bbox

### SVG Furniture Catalog
- Structure: `<g id="b2"><path class="bg" d="..."/></g>`
- **Scale**: 1px = 1cm (to be verified)
- **No explicit dimensions** â†’ extract from bbox
- **No names** â†’ ID is the key (e.g., "b2", "sz", "sh")

---

## ğŸ¤” Open Questions (for tomorrow)

### 1. SVG Scale Factor
- Is 1px = 1cm accurate?
- Or is there a different conversion factor?
- **Action**: Check actual furniture sizes after extraction

### 2. Furniture ID Coverage
- Which IDs appear in apartments?
- Are all of them in the SVG catalog?
- **Action**: Compare EDA results with catalog

### 3. Data Quality
- What % of apartments have furniture?
- Are there incomplete boundaries?
- **Action**: Run validation checks

---

## ğŸš€ Next Steps (Tomorrow)

### Priority 1: Data Upload
1. Upload 5-10 sample apartment JSONs to `samples/`
2. Upload furniture catalog SVG to `samples/`

### Priority 2: Catalog Extraction
1. Run `extract_furniture_catalog.ipynb`
2. Verify dimensions make sense
3. Adjust `SVG_SCALE_FACTOR` if needed
4. Generate `furniture_catalog.json`

### Priority 3: EDA
1. Run `eda_apartments.ipynb` on sample data
2. Identify furniture IDs and room types
3. Check for missing data
4. Validate semantic pairs

### Priority 4: Analysis
- Compare furniture IDs in apartments vs catalog
- Decide on next week's pipeline work
- Potentially start on Stage 1 data prep

---

## ğŸ’¡ Technical Notes

### Embeddings Question
User asked: *"Czy takie dane majÄ… coÅ› z embeddingÃ³w? Parowanie mebla z pomieszczeniem?"*

**Answer**: 
- Embeddings nie sÄ… rozwiÄ…zaniem same w sobie
- ALE: W Stage 1, LLM stworzy wewnÄ™trzne embeddings dla:
  - Room types (`idBedroom`, `idBathroom`, ...)
  - Furniture IDs (`b2`, `sz`, `sh`, ...)
- Model nauczy siÄ™ Å¼e:
  - `idBedroom` embedding jest "blisko" `b2` embedding
  - `idBathroom` embedding jest "blisko" `sh`, `wc` embeddings
- To dzieje siÄ™ automatycznie podczas fine-tuningu!

### Insert Point System
From user: *"insert_point dziaÅ‚a jak w SVG wzglÄ™dem lewego-gÃ³rnego rogu"*

**Confirmed**:
- Insert point = top-left corner of furniture bbox
- Applied in room coordinate system
- Furniture can be rotated (`angle`) and scaled (`x_scale`, `y_scale`)
- Final position = transform(insert_point, angle, scale)

### Scale Factors
- JSON coordinates: likely centimeters
- SVG: 1px = 1cm (or constant factor)
- Output dimensions: convert to meters for model

---

## ğŸ“ Files Created Today

```
ai_furnishing_exploration/
â”œâ”€â”€ PRD.md                                    âœ…
â”œâ”€â”€ README.md                                 âœ…
â”œâ”€â”€ TODO.md                                   âœ…
â”œâ”€â”€ notebooks/
â”‚   â”œâ”€â”€ eda_apartments.ipynb                  âœ…
â”‚   â”œâ”€â”€ extract_furniture_catalog.ipynb       âœ…
â”‚   â””â”€â”€ visualize_apartments.ipynb            âœ…
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ json_processing.py                    âœ…
â”‚   â”œâ”€â”€ svg_parser.py                         âœ…
â”‚   â””â”€â”€ furniture_catalog.py                  âœ…
â”œâ”€â”€ samples/
â”‚   â””â”€â”€ README.md                             âœ…
â””â”€â”€ results/                                  âœ…

datasets_pipelines/apartment_jsons_pipe/
â”œâ”€â”€ 0_scan/                                   âœ…
â”œâ”€â”€ 1_collect/                                âœ…
â”œâ”€â”€ 2_validate/                               âœ…
â”œâ”€â”€ 3_process/                                âœ…
â”œâ”€â”€ 4_split/                                  âœ…
â”œâ”€â”€ configs/
â”‚   â””â”€â”€ dataset_config.md                     âœ…
â””â”€â”€ logs/                                     âœ…
```

---

## ğŸ“ Lessons Learned

### 1. Separate Semantic from Geometric
- Don't ask LLM to do everything
- Play to strengths: LLM for patterns, rules/solvers for geometry

### 2. Start with Data Understanding
- Before any modeling, understand what you have
- EDA â†’ reveals data quality issues early
- Catalog extraction â†’ ensures all IDs are covered

### 3. Incremental Approach
- Start with samples (5-10 apartments)
- Validate approach before scaling to 100k
- Quick prototype â†’ fail fast if needed

---

## ğŸ“š References

### Consulted LLM Analysis (External)
âœ… **Valid points**:
- 100k apartments is sufficient for fine-tuning
- LLM can learn semantic patterns (roomâ†’furniture)
- Hybrid approach (rules + ML) is pragmatic
- Start with small prototype

âš ï¸ **Missed details**:
- Didn't address geometric placement challenge specifically
- Didn't suggest separating semantic vs spatial models
- Didn't discuss furniture dimensions extraction

### Our Additions:
- Explicit 2-stage pipeline design
- SVG parsing utilities
- Visualization tools
- Concrete next steps

---

**End of Day Summary**: Project is now well-structured and ready for data ingestion tomorrow! ğŸ‰
